# 1C Dev Tools

Расширение для Cursor с инструментами разработки для экосистемы 1С. Предоставляет удобный интерфейс для работы с проектами 1С через панель команд и дерево задач.

## Возможности

Все команды организованы по категориям и доступны через:

- Откройте панель "1C Dev Tools"
- Все команды доступны через дерево задач в нижней панели

### Палитра команд
- Все команды доступны через поиск в палитре команд

### Доступные команды

- **Информационные базы**
  - Создать пустую ИБ
  - Постобработка обновления
  - Запретить работу с внешними ресурсами
  - Выгрузить в dt / Загрузить из dt

- **Конфигурация**
  - Загрузить из src/cf (загрузка основной конфигурации из исходников)
  - Обновить из src/cf (обновление основной конфигурации из исходников которые указаны в файле build/commit/Commit.txt)
  - Загрузить из 1Cv8.cf
  - Выгрузить в src/cf (выгрузка основной конфигурации в исходники)
  - Выгрузить обновление в src/cf (выгрузка только изменений основной конфигурации в исходники)
  - Выгрузить в 1Cv8.cf
  - Выгрузить файл поставки в 1Cv8dist.cf
  - Собрать 1Cv8.cf из src/cf
  - Разобрать 1Cv8.cf в src/cf

- **Расширения**
  - Загрузить из src/cfe (загрузка всех расширений из исходников, расширения делятся на подкаталоги)
  - Загрузить из \*.cfe
  - Выгрузить в src/cfe (выгрузка всех расширений в исходники, расширения делятся на подкаталоги)
  - Выгрузить обновление в src/cfe (выгрузка только изменений всех расширений в исходники, расширения делятся на подкаталоги)
  - Обновить из src/cfe (обновление всех расширений из исходников которые указаны в файле build/commit/Commit.txt)
  - Выгрузить в \*.cfe
  - Собрать \*.cfe из src/cfe
  - Разобрать \*.cfe в src/cfe

- **Внешние файлы**
  - Собрать внешнюю обработку / внешний отчёт
  - Разобрать внешнюю обработку / внешний отчёт
  - Очистить кэш

- **Зависимости**
  - Инициализировать packagedef
  - Установить / Удалить зависимости

- **Запуск**
  - Запустить Предприятие
  - Запустить Конфигуратор

- **Задачи и конфигурации**
  - Задачи (workspace) — из tasks.json
  - Конфигурации запуска — env.json, launch.json

## Требования

- Cursor IDE
- Node.js версии 18.x или выше
- OneScript (oscript) - для выполнения скриптов. Ссылка https://oscript.io/

## Установка

- В переменных windows окружения создать переменную oscript (указать путь C:\Program Files\OneScript\bin\oscript.exe)

1. Откройте Cursor
2. Нажмите Ctrl+Shift+P - установка пакета vsix
3. Выберите файл
4. Закройте Cursor, откройте повторно


## Настройка

Примеры файлов packagedef + env.json в репозитории.

Расширение автоматически активируется при открытии проекта 1С (наличие файла `packagedef` в корне проекта).

Настройки доступны через в "1C Dev Tools" - "Конфигурации запуска". Параметры подключения к информационной базе настраиваются в файле `env.json` в корне проекта:

```json
{
  "default": {
    "--ibconnection": "/F./build/ib"
  }
}
```
### Параметры отладки модулей BSL (dbgs.exe)

При активации расширения `1C Dev Tools`:
 - если сервер отладки локально: выполняется попытка запуска сервера отладки http! Для этого в конфигураторе измените режим запуска отладки на http протокол.
 - если сервер отладки удаленно: выполняется попытка подключения.

Обязательные параметры в `env.json`:

```json
{
  "default": {
    "--v8version": "8.3.27",
    "--v8-platform-root": "${env:PROGRAMFILES}/1cv8",
    "--debug-server": "<имя сервера отладки или если локально то имя компьютера>",
    "--debug-port-range": "1560:1591",
    "--ibconnection": "/F./build/ib",
    "--infoBase": "Информационная база #2"
  }
}
```

- `--ibconnection` — строка подключения к ИБ для **запуска 1cv8c** (например `/F./build/ib` или путь к файловой ИБ).
- `--infoBase` — **имя/алиас ИБ для RDBG** (сервер отладки). Подставляется в запросы как `infoBaseAlias`. Для файловой ИБ в onec-debug-adapter используют `DefAlias`; для серверной — имя из списка баз (например «Информационная база #2»).

В папке с проектом создайте .vscode/launch.json. Параметры `debugServerHost`, `debugServerPort`, `ibconnection`, `infoBase` подставляются из env.json при отсутствии в конфигурации:

```json
{
	"version": "0.2.0",
	"configurations": [
		{
			"type": "onec",
			"request": "launch",
			"name": "1C: Запуск",
			"rootProject": "${workspaceFolder}",
			"autoAttachTypes": ["Client", "Server"]
		},
		{
			"type": "onec",
			"request": "attach",
			"name": "1C: Присоединиться",
			"autoAttachTypes": ["Client", "Server"]
		}
	]
}
```

Соответствие onec-debug-adapter (C#): запуск 1cv8c — по нашему через `/F` и путь из `ibconnection`; в onec используют `/IBNAME` и имя базы из списка. В RDBG мы передаём `infoBaseAlias` из `--infoBase` (как у них InfoBaseName: для файловой ИБ они подставляют «DefAlias», для серверной — Ref из строки подключения). Точки останова в onec передаются только по ObjectId/PropertyId модуля (без URL); у нас при отсутствии метаданных передаётся полный путь в URL.

Формат XML-запросов RDBG (из EMF-модели EDT): [`docs/RDBG_REQUEST_FORMAT.md`](docs/RDBG_REQUEST_FORMAT.md)

## Структура проекта

Расширение опирается на структуру каталогов проекта [vanessa-bootstrap]

Рекомендуемая структура проекта:

```txt
project/
├── build/
│   ├── ib/                 # Информационная база
│   └── out/                # Собранные файлы
│   └── commit/Commit.txt   # Файл куда пишем наши изменения
├── src/
│   ├── cf/                 # Исходники конфигурации
│   ├── cfe/                # Исходники расширений
│   ├── epf/                # Исходники внешних обработок
│   └── erf/                # Исходники внешних отчетов
├── oscript_modules/        # Зависимости oscript
├── env.json                # Настройки подключения к ИБ
└── packagedef              # Файл для активации расширения
```

## Важные нюансы

- Все команды выполняются в терминале Cursor для видимости вывода
- Параметр `--ibconnection` берется из `env.json` (секция `default['--ibconnection']`, по умолчанию `/F./build/ib`)
- Пути в настройках задаются относительно корня проекта или абсолютно; при вызове платформы 1С расширение подставляет итоговые абсолютные пути
- В каталог oscript_modules/ с проектом копируем содержимое из репозитория oscript_modules/v8runner
- В файл Commit.txt пишем что поменяли, пример:
    e:\DATA1C\BASE\src\cf\Catalogs\Подразделения\Ext\Predefined.xml
    e:\DATA1C\BASE\src\cf\Documents\Сборка\Ext\ObjectModule.bsl

## ВАЖНО
- за основу взят проект https://github.com/yellow-hammer/1c-dev-tools